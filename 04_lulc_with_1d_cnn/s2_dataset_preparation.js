var aoi =
    /* color: #d63000 */
    /* shown: false */
    /* displayProperties: [
      {
        "type": "rectangle"
      }
    ] */
    ee.FeatureCollection([
      ee.Feature(
        ee.Geometry.Polygon(
          [
            [
              [83.86452553461008, 28.30505771477915],
              [83.86452553461008, 28.089621623362035],
              [84.18724892328196, 28.089621623362035],
              [84.18724892328196, 28.30505771477915],
            ],
          ],
          null,
          false
        ),
        {
          "system:index": "0",
        }
      ),
    ]),
  rgb_viz = {
    opacity: 1,
    bands: ["B4", "B3", "B2"],
    min: 0.045795999914407734,
    max: 0.237604006677866,
    gamma: 1,
  },
  water =
    /* color: #98ff00 */
    /* displayProperties: [
      {
        "type": "rectangle"
      },
      {
        "type": "polygon"
      },
      {
        "type": "polygon"
      },
      {
        "type": "polygon"
      },
      {
        "type": "polygon"
      },
      {
        "type": "polygon"
      },
      {
        "type": "polygon"
      },
      {
        "type": "polygon"
      },
      {
        "type": "polygon"
      },
      {
        "type": "polygon"
      },
      {
        "type": "polygon"
      },
      {
        "type": "polygon"
      },
      {
        "type": "polygon"
      },
      {
        "type": "polygon"
      },
      {
        "type": "polygon"
      },
      {
        "type": "polygon"
      },
      {
        "type": "polygon"
      },
      {
        "type": "polygon"
      },
      {
        "type": "polygon"
      },
      {
        "type": "polygon"
      },
      {
        "type": "polygon"
      },
      {
        "type": "polygon"
      },
      {
        "type": "polygon"
      },
      {
        "type": "polygon"
      },
      {
        "type": "polygon"
      },
      {
        "type": "polygon"
      }
    ] */
    ee.FeatureCollection([
      ee.Feature(
        ee.Geometry.Polygon(
          [
            [
              [83.94026898955053, 28.218053773591596],
              [83.94026898955053, 28.217486546349],
              [83.94172811125463, 28.217486546349],
              [83.94172811125463, 28.218053773591596],
            ],
          ],
          null,
          false
        ),
        {
          class: 3,
          "system:index": "0",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [83.9475216827268, 28.21272171855193],
            [83.94790792082495, 28.213856220644296],
            [83.94644879912084, 28.21306207044506],
          ],
        ]),
        {
          class: 3,
          "system:index": "1",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [83.9937274608505, 28.215530957601644],
            [83.99389912222745, 28.215218975620335],
            [83.99392057989957, 28.21552150361562],
          ],
        ]),
        {
          class: 3,
          "system:index": "2",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [83.99433900450589, 28.2131107098564],
            [83.99439264868619, 28.213384881301113],
            [83.99416734312894, 28.21315798084537],
          ],
        ]),
        {
          class: 3,
          "system:index": "3",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [83.98384049785419, 28.190639876985266],
            [83.98392096412464, 28.190370375276817],
            [83.98395851505084, 28.190639876985266],
          ],
        ]),
        {
          class: 3,
          "system:index": "4",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [83.98733136995153, 28.186577741009067],
            [83.98721871717291, 28.186407523015163],
            [83.98733136995153, 28.18632241391659],
            [83.98746011598425, 28.186454805818418],
          ],
        ]),
        {
          class: 3,
          "system:index": "5",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.09545531143183, 28.17371627688913],
            [84.09708609451289, 28.171522071461254],
            [84.09717192520137, 28.174472889015238],
          ],
        ]),
        {
          class: 3,
          "system:index": "6",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.11538948883052, 28.17057627937984],
            [84.11654820312495, 28.17089784962563],
            [84.11575426925654, 28.17089784962563],
          ],
        ]),
        {
          class: 3,
          "system:index": "7",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.11146273483271, 28.17207062703737],
            [84.11176314224238, 28.17135182950365],
            [84.11193480361933, 28.1723543615765],
          ],
        ]),
        {
          class: 3,
          "system:index": "8",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.09824480880732, 28.168836000104456],
            [84.09929623474116, 28.168173929903944],
            [84.09910311569209, 28.16959264674579],
          ],
        ]),
        {
          class: 3,
          "system:index": "9",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.02878107100024, 28.1887755229185],
            [84.02876497774615, 28.18858639568536],
            [84.0288990881969, 28.188789707447494],
          ],
        ]),
        {
          class: 3,
          "system:index": "10",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.06901415627682, 28.180936359443606],
            [84.06922873299801, 28.18063373352381],
            [84.06948622506344, 28.181144414266708],
          ],
        ]),
        {
          class: 3,
          "system:index": "11",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.07886112313017, 28.174505004128896],
            [84.07922590355619, 28.174069952940886],
            [84.07924736122831, 28.17471307146293],
          ],
        ]),
        {
          class: 3,
          "system:index": "12",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.10911980108263, 28.1479507672569],
            [84.10917129245591, 28.147877047637056],
            [84.10921420780015, 28.148009487114663],
          ],
        ]),
        {
          class: 3,
          "system:index": "13",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.07948601585562, 28.093929873069893],
            [84.07936799865897, 28.09359860701383],
            [84.07963621956046, 28.093778437285387],
          ],
        ]),
        {
          class: 3,
          "system:index": "14",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.07869208198721, 28.092226208175838],
            [84.0785633359545, 28.091828682476386],
            [84.07882082801993, 28.09199905081353],
          ],
        ]),
        {
          class: 3,
          "system:index": "15",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.08294796808718, 28.1206942738666],
            [84.08304452761172, 28.120382015244594],
            [84.08316254480837, 28.120817284589194],
          ],
        ]),
        {
          class: 3,
          "system:index": "16",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [83.87837192271205, 28.251835595399026],
            [83.87833973620387, 28.251561522727762],
            [83.87852212641688, 28.251589875105722],
            [83.87851070081093, 28.251836613014543],
          ],
        ]),
        {
          class: 3,
          "system:index": "17",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.01182483701066, 28.109881503854893],
            [84.01162098912553, 28.11002345360376],
            [84.01109527615861, 28.109900430498936],
          ],
        ]),
        {
          class: 3,
          "system:index": "18",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.01218961743669, 28.10970170056996],
            [84.01240419415788, 28.109588140445258],
            [84.01277970341997, 28.10954082369114],
            [84.01311229733781, 28.109266386105656],
            [84.01325177220659, 28.109417800032745],
            [84.01277970341997, 28.109739553918143],
            [84.01246856717424, 28.109767943920517],
          ],
        ]),
        {
          class: 3,
          "system:index": "19",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.01497235707177, 28.105561891894133],
            [84.01499917916192, 28.105401008806613],
            [84.01606669834985, 28.105386813228503],
            [84.01611497811211, 28.105542964484595],
          ],
        ]),
        {
          class: 3,
          "system:index": "20",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.02772751020782, 28.09862730306877],
            [84.02743783163422, 28.098324444542335],
            [84.02738418745392, 28.09810676444848],
            [84.02744856047028, 28.097936405806173],
            [84.02762022184723, 28.098191943668212],
            [84.02779188322418, 28.098466409583025],
          ],
        ]),
        {
          class: 3,
          "system:index": "21",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [83.94588851732074, 28.216962120586988],
            [83.94647860330402, 28.216139631693505],
            [83.94712233346759, 28.217189012959977],
          ],
        ]),
        {
          class: 3,
          "system:index": "22",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.05011296517212, 28.193289127476078],
            [84.0500915075, 28.19448057104137],
            [84.04921174294311, 28.194386012513466],
          ],
        ]),
        {
          class: 3,
          "system:index": "23",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.0874779438751, 28.118141213217147],
            [84.08743502853086, 28.118368315233237],
            [84.08689858672788, 28.1183493900836],
          ],
        ]),
        {
          class: 3,
          "system:index": "24",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.11321533132433, 28.155355580076517],
            [84.1129578392589, 28.15376640456687],
            [84.1138590614879, 28.15471234521192],
          ],
        ]),
        {
          class: 3,
          "system:index": "25",
        }
      ),
    ]),
  vegetation =
    /* color: #0b4a8b */
    /* shown: false */
    ee.FeatureCollection([
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [83.96381986979851, 28.155477051893353],
            [83.96442059381836, 28.15464663951828],
            [83.96459225519531, 28.155743920869142],
          ],
        ]),
        {
          class: 1,
          "system:index": "0",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [83.98102883203858, 28.152187174947684],
            [83.98072842462891, 28.151241211992318],
            [83.9818442235791, 28.152111498218808],
          ],
        ]),
        {
          class: 1,
          "system:index": "1",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [83.94146088465088, 28.15937622027357],
            [83.94210461481445, 28.158770845598678],
            [83.94219044550293, 28.15948972764396],
          ],
        ]),
        {
          class: 1,
          "system:index": "2",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.15069139220621, 28.274268520060183],
            [84.15172136046793, 28.272907886974227],
            [84.15215051391031, 28.275402367689484],
          ],
        ]),
        {
          class: 1,
          "system:index": "3",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.1379026196232, 28.279635292198705],
            [84.13961923339274, 28.27903059899702],
            [84.13927591063883, 28.28061791132878],
          ],
        ]),
        {
          class: 1,
          "system:index": "4",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.13541352965738, 28.264290140550177],
            [84.1375592968693, 28.263080576505015],
            [84.13695848204996, 28.265046111106955],
          ],
        ]),
        {
          class: 1,
          "system:index": "5",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.00231517261244, 28.26490523341562],
            [84.00454677051283, 28.26407366440894],
            [84.00454677051283, 28.265585603230967],
          ],
        ]),
        {
          class: 1,
          "system:index": "6",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [83.99647734307298, 28.266628924976647],
            [83.99707950061537, 28.267551091629702],
            [83.99562037891127, 28.267248711158825],
          ],
        ]),
        {
          class: 1,
          "system:index": "7",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [83.94972129854025, 28.252964027580003],
            [83.95057960542502, 28.250544628713158],
            [83.95263954194846, 28.254173706426293],
          ],
        ]),
        {
          class: 1,
          "system:index": "8",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [83.91229911836447, 28.275945578266153],
            [83.91521736177268, 28.274131425517655],
            [83.91556068452658, 28.277003819767643],
          ],
        ]),
        {
          class: 1,
          "system:index": "9",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.06669760087759, 28.15573797109392],
            [84.06714821199209, 28.15537851807699],
            [84.0670409236315, 28.15607850441772],
          ],
        ]),
        {
          class: 1,
          "system:index": "10",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.07071018556387, 28.153656910578924],
            [84.07126808503897, 28.153373126465425],
            [84.07126808503897, 28.153808261798577],
          ],
        ]),
        {
          class: 1,
          "system:index": "11",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [83.98792592984361, 28.18838903939913],
            [83.98856966000719, 28.187935131836568],
            [83.98841945630235, 28.18880511963851],
          ],
        ]),
        {
          class: 1,
          "system:index": "12",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.12281108002888, 28.14992415114381],
            [84.12296128373372, 28.148618692484373],
            [84.12351918320881, 28.149186285161374],
          ],
        ]),
        {
          class: 1,
          "system:index": "13",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.12690949540364, 28.15323502564911],
            [84.12572932343708, 28.152572858938303],
            [84.12673783402668, 28.1516647379328],
          ],
        ]),
        {
          class: 1,
          "system:index": "14",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.10062474509893, 28.1473798432041],
            [84.10086077949224, 28.146547358872308],
            [84.10133284827886, 28.147417683247262],
          ],
        ]),
        {
          class: 1,
          "system:index": "15",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.09807128211675, 28.145695947748607],
            [84.0981356551331, 28.144920211720894],
            [84.09877938529668, 28.14586623051484],
          ],
        ]),
        {
          class: 1,
          "system:index": "16",
        }
      ),
    ]),
  cultivation =
    /* color: #ffc82d */
    /* shown: false */
    ee.FeatureCollection([
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.03560712239245, 28.195785494273338],
            [84.03588607213, 28.19548291038396],
            [84.03601481816271, 28.196106988717172],
          ],
        ]),
        {
          class: 2,
          "system:index": "0",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.02144505879382, 28.196712152105526],
            [84.02200295826891, 28.19656086157971],
            [84.02180983921984, 28.197071466246005],
          ],
        ]),
        {
          class: 2,
          "system:index": "1",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.01781871220568, 28.189014974900996],
            [84.01848390004137, 28.188769109983372],
            [84.01826932332018, 28.18920410137594],
          ],
        ]),
        {
          class: 2,
          "system:index": "2",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.0381888118577, 28.186904503681568],
            [84.03829610021829, 28.18741515447657],
            [84.03771674307107, 28.18709363389003],
          ],
        ]),
        {
          class: 2,
          "system:index": "3",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.00839902008512, 28.17506607478788],
            [84.00887108887174, 28.17415814462914],
            [84.0090427502487, 28.175179565515904],
          ],
        ]),
        {
          class: 2,
          "system:index": "4",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.01125289047697, 28.17294755909676],
            [84.01093102539518, 28.172342261193258],
            [84.01172495926359, 28.172531417156016],
          ],
        ]),
        {
          class: 2,
          "system:index": "5",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.00957243556554, 28.169922082802994],
            [84.00991575831945, 28.16903302518676],
            [84.0100874196964, 28.17096245999425],
          ],
        ]),
        {
          class: 2,
          "system:index": "6",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.00324235820494, 28.15978585044757],
            [84.00354276561461, 28.1591237242553],
            [84.00382171535216, 28.160107453120236],
          ],
        ]),
        {
          class: 2,
          "system:index": "7",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.0162341926663, 28.15536431823029],
            [84.01677063446928, 28.155023782634707],
            [84.01666334610869, 28.155685934187044],
          ],
        ]),
        {
          class: 2,
          "system:index": "8",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.0556514776528, 28.157331903982275],
            [84.05614500411154, 28.156764354485958],
            [84.05612354643942, 28.15750216824442],
          ],
        ]),
        {
          class: 2,
          "system:index": "9",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.04839878447653, 28.15755892293829],
            [84.04899959929587, 28.157067047925118],
            [84.04908542998434, 28.157653514027846],
          ],
        ]),
        {
          class: 2,
          "system:index": "10",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.06403684953482, 28.161262795070563],
            [84.06450891832144, 28.1608276900382],
            [84.06422996858389, 28.16160331081862],
          ],
        ]),
        {
          class: 2,
          "system:index": "11",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.00703800335977, 28.195594334175293],
            [84.00635135785195, 28.195216103503178],
            [84.00735986844155, 28.19517828036235],
          ],
        ]),
        {
          class: 2,
          "system:index": "12",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.00038612500283, 28.192700835486946],
            [84.00077236310098, 28.192398242864755],
            [84.00087965146157, 28.192776483508673],
          ],
        ]),
        {
          class: 2,
          "system:index": "13",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [83.91401698146369, 28.230399045183088],
            [83.91463925395514, 28.23006666416267],
            [83.91472508464362, 28.230917403632404],
          ],
        ]),
        {
          class: 2,
          "system:index": "14",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [83.9096610740235, 28.228384070574645],
            [83.91069104228522, 28.22793033293111],
            [83.91043355021979, 28.22910248456525],
          ],
        ]),
        {
          class: 2,
          "system:index": "15",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [83.9216559127381, 28.22910248456525],
            [83.92247130427863, 28.22876218380407],
            [83.9223211005738, 28.22957512271122],
          ],
        ]),
        {
          class: 2,
          "system:index": "16",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [83.94967969723186, 28.139363771453876],
            [83.94944366283855, 28.139141444292235],
            [83.95062112831003, 28.139162709539793],
            [83.95066404365427, 28.139356654497778],
          ],
        ]),
        {
          class: 2,
          "system:index": "17",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [83.94611017581198, 28.13840584780854],
            [83.94657688018057, 28.138263935638637],
            [83.94686655875418, 28.13892146044352],
            [83.94605653163168, 28.13875116663669],
          ],
        ]),
        {
          class: 2,
          "system:index": "18",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [83.91083621112676, 28.167536278823995],
            [83.91066454974981, 28.165947284159312],
            [83.91263865558477, 28.166098618001133],
          ],
        ]),
        {
          class: 2,
          "system:index": "19",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [83.98503214441389, 28.178923383342784],
            [83.98486048303694, 28.17801548592595],
            [83.9857187899217, 28.177939827459998],
            [83.98580462061018, 28.179112527667893],
          ],
        ]),
        {
          class: 2,
          "system:index": "20",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [83.93681954705694, 28.272781279713016],
            [83.93793534600714, 28.27092927677569],
            [83.94055318200567, 28.272063159946647],
          ],
        ]),
        {
          class: 2,
          "system:index": "21",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [83.9448447164295, 28.27724107302905],
            [83.94600343072393, 28.276334011549082],
            [83.94578885400274, 28.27761901303256],
          ],
        ]),
        {
          class: 2,
          "system:index": "22",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.10411198173263, 28.14212908582083],
            [84.10406906638839, 28.141126270644953],
            [84.10462696586349, 28.142034481016616],
          ],
        ]),
        {
          class: 2,
          "system:index": "23",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.10590301946547, 28.136126252854204],
            [84.10607468084243, 28.135369369671842],
            [84.10641800359633, 28.136164096872953],
          ],
        ]),
        {
          class: 2,
          "system:index": "24",
        }
      ),
    ]),
  builtup = /* color: #00ffff */ ee.FeatureCollection([
    ee.Feature(
      ee.Geometry.Polygon([
        [
          [83.9806614866246, 28.196061349679745],
          [83.98018941783798, 28.196477400055016],
          [83.97997484111679, 28.195891146786682],
        ],
      ]),
      {
        class: 4,
        "system:index": "0",
      }
    ),
    ee.Feature(
      ee.Geometry.Polygon([
        [
          [83.98802146816146, 28.19793356361342],
          [83.98838624858749, 28.197536430065245],
          [83.98838624858749, 28.19812267430813],
        ],
      ]),
      {
        class: 4,
        "system:index": "1",
      }
    ),
    ee.Feature(
      ee.Geometry.Polygon([
        [
          [83.99787053966415, 28.196571956732612],
          [83.99840698146713, 28.196798892417476],
          [83.99789199733627, 28.19708256134588],
        ],
      ]),
      {
        class: 4,
        "system:index": "2",
      }
    ),
    ee.Feature(
      ee.Geometry.Polygon([
        [
          [83.97918910791373, 28.186797124842887],
          [83.9787170391271, 28.18721321127776],
          [83.97869558145499, 28.18660799410992],
        ],
      ]),
      {
        class: 4,
        "system:index": "3",
      }
    ),
    ee.Feature(
      ee.Geometry.Polygon([
        [
          [84.0041187568536, 28.181936358819417],
          [84.00444062193539, 28.181331111783138],
          [84.00450499495174, 28.182163325574866],
        ],
      ]),
      {
        class: 4,
        "system:index": "4",
      }
    ),
    ee.Feature(
      ee.Geometry.Polygon([
        [
          [84.01060781783328, 28.177761861005852],
          [84.01099405593142, 28.177024186930655],
          [84.01092968291506, 28.178064495052123],
        ],
      ]),
      {
        class: 4,
        "system:index": "5",
      }
    ),
    ee.Feature(
      ee.Geometry.Polygon([
        [
          [84.01398993964692, 28.184157577570083],
          [84.0149769925644, 28.183609083982418],
          [84.01448346610566, 28.18427105865075],
        ],
      ]),
      {
        class: 4,
        "system:index": "6",
      }
    ),
    ee.Feature(
      ee.Geometry.Polygon([
        [
          [84.01364661689301, 28.189006694980957],
          [84.0136251592209, 28.187815190402826],
          [84.01465512748261, 28.188628440998023],
        ],
      ]),
      {
        class: 4,
        "system:index": "7",
      }
    ),
    ee.Feature(
      ee.Geometry.Polygon([
        [
          [84.0122947835495, 28.190406223080878],
          [84.0129599713852, 28.189782111461984],
          [84.01270247931977, 28.190727733704936],
        ],
      ]),
      {
        class: 4,
        "system:index": "8",
      }
    ),
    ee.Feature(
      ee.Geometry.Polygon([
        [
          [83.9909873151352, 28.191654435387377],
          [83.99135209556123, 28.191200541689597],
          [83.99141646857758, 28.19182464502716],
        ],
      ]),
      {
        class: 4,
        "system:index": "9",
      }
    ),
    ee.Feature(
      ee.Geometry.Polygon([
        [
          [83.99113751884003, 28.19044404791035],
          [83.99137355323334, 28.190841207811992],
          [83.99079419608613, 28.190519697529197],
        ],
      ]),
      {
        class: 4,
        "system:index": "10",
      }
    ),
    ee.Feature(
      ee.Geometry.Polygon([
        [
          [84.01008499280069, 28.193930109205837],
          [84.00944126263711, 28.193740991092373],
          [84.00997770444009, 28.193514048914494],
          [84.00993478909585, 28.193154722814086],
          [84.01057851925943, 28.193419489531497],
        ],
      ]),
      {
        class: 4,
        "system:index": "11",
      }
    ),
    ee.Feature(
      ee.Geometry.Polygon([
        [
          [83.98224382044445, 28.213434175595616],
          [83.98187904001843, 28.21301819125052],
          [83.98267297388684, 28.212866923814204],
          [83.98290900828015, 28.213245092003252],
        ],
      ]),
      {
        class: 4,
        "system:index": "12",
      }
    ),
    ee.Feature(
      ee.Geometry.Polygon([
        [
          [83.95698742555497, 28.210851126562723],
          [83.95707325624345, 28.209735501547616],
          [83.95775990175126, 28.21013258975304],
          [83.95754532503007, 28.210926761735212],
        ],
      ]),
      {
        class: 4,
        "system:index": "13",
      }
    ),
    ee.Feature(
      ee.Geometry.Polygon([
        [
          [83.9644972812978, 28.20516713023626],
          [83.96398229716694, 28.204580924642325],
          [83.9648406040517, 28.204354005484365],
        ],
      ]),
      {
        class: 4,
        "system:index": "14",
      }
    ),
    ee.Feature(
      ee.Geometry.Polygon([
        [
          [83.97318754174266, 28.206479972113407],
          [83.97269401528392, 28.20621523775488],
          [83.97340211846385, 28.206158508878417],
        ],
      ]),
      {
        class: 4,
        "system:index": "15",
      }
    ),
    ee.Feature(
      ee.Geometry.Polygon([
        [
          [83.95843110024636, 28.209354188633956],
          [83.9589246267051, 28.208446549666604],
          [83.95894608437722, 28.20965673324252],
        ],
      ]),
      {
        class: 4,
        "system:index": "16",
      }
    ),
  ]),
  cloud =
    /* color: #bf04c2 */
    /* shown: false */
    ee.FeatureCollection([
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.16440889280831, 28.276360514108173],
            [84.16453763884103, 28.275680213098298],
            [84.16543886107003, 28.276360514108173],
          ],
        ]),
        {
          class: 5,
          "system:index": "0",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.17170450132882, 28.274697548413396],
            [84.17209073942696, 28.273941646333373],
            [84.17251989286935, 28.274659753436787],
          ],
        ]),
        {
          class: 5,
          "system:index": "1",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.1734581907652, 28.27432578868054],
            [84.1734581907652, 28.27408956903236],
            [84.17368349632245, 28.27415571058664],
          ],
        ]),
        {
          class: 5,
          "system:index": "2",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.162612995446, 28.277911144369178],
            [84.16308506423262, 28.27866701827971],
            [84.161711773217, 28.278704811834405],
          ],
        ]),
        {
          class: 5,
          "system:index": "3",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.16591747695234, 28.275643490451753],
            [84.16591747695234, 28.274660825428064],
            [84.16677578383711, 28.27526554343853],
          ],
        ]),
        {
          class: 5,
          "system:index": "4",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.17003734999922, 28.269709567604348],
            [84.16977985793379, 28.268764644925927],
            [84.17032912498077, 28.26913620041425],
            [84.170372040325, 28.269551965975296],
          ],
        ]),
        {
          class: 5,
          "system:index": "5",
        }
      ),
    ]),
  sand =
    /* color: #ff0000 */
    /* shown: false */
    ee.FeatureCollection([
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [83.87839311712511, 28.25288096560433],
            [83.87865060919054, 28.252276120563113],
            [83.87876678878376, 28.25288955381838],
          ],
        ]),
        {
          class: 6,
          "system:index": "0",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [83.87670895312282, 28.24786619827696],
            [83.87662312243434, 28.247223520083168],
            [83.87705227587672, 28.247885100518157],
          ],
        ]),
        {
          class: 6,
          "system:index": "1",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [83.89063679703573, 28.24031906886958],
            [83.89078700074056, 28.24006387022866],
            [83.89113032349447, 28.239846478312273],
            [83.89101230629781, 28.240120581090512],
            [83.89070117005208, 28.240470297405757],
          ],
        ]),
        {
          class: 6,
          "system:index": "2",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [83.89352285393575, 28.23879731979205],
            [83.89416658409932, 28.238759512085185],
            [83.89418804177144, 28.23909978096449],
            [83.89353358277181, 28.239061973364844],
          ],
        ]),
        {
          class: 6,
          "system:index": "3",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [83.91385233350363, 28.22776712787603],
            [83.91432440229025, 28.227502446288433],
            [83.91509687848654, 28.227426822857154],
            [83.91554748960104, 28.227540257983996],
            [83.91578352399435, 28.22772931626085],
            [83.9160088295516, 28.22807907319017],
            [83.91450679250326, 28.227776580777714],
          ],
        ]),
        {
          class: 6,
          "system:index": "4",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [83.90289967109165, 28.23759769328346],
            [83.90289967109165, 28.23683207599935],
            [83.90311424781284, 28.236567416894882],
            [83.90353267241916, 28.236520156271443],
            [83.90327518035373, 28.23759769328346],
          ],
        ]),
        {
          class: 6,
          "system:index": "5",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.08350301118547, 28.120662118035224],
            [84.08361029954607, 28.119942975386078],
            [84.08393216462785, 28.12061698500575],
          ],
        ]),
        {
          class: 6,
          "system:index": "6",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.0841038260048, 28.1188664312423],
            [84.08473682733232, 28.118875893771932],
            [84.08462953897173, 28.11932063172138],
          ],
        ]),
        {
          class: 6,
          "system:index": "7",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.08396435113603, 28.119576118645313],
            [84.08371758790666, 28.119301706739822],
            [84.08424330087358, 28.11948149392965],
          ],
        ]),
        {
          class: 6,
          "system:index": "8",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [83.97370711298237, 28.175282415835845],
            [83.97413626642475, 28.174885198142988],
            [83.97422209711323, 28.175320246015367],
          ],
        ]),
        {
          class: 6,
          "system:index": "9",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [83.97199049921284, 28.176436230292623],
            [83.97224799127827, 28.176020101923484],
            [83.97231236429462, 28.17673886808971],
          ],
        ]),
        {
          class: 6,
          "system:index": "10",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [83.97952214212665, 28.174298826471944],
            [83.97986546488056, 28.174658215941953],
            [83.97917881937275, 28.174620385528293],
          ],
        ]),
        {
          class: 6,
          "system:index": "11",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.00947522191362, 28.10997613704167],
            [84.00958251027421, 28.109531360337797],
            [84.00982927350358, 28.109909893819683],
          ],
        ]),
        {
          class: 6,
          "system:index": "12",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.0137774851735, 28.109342093095933],
            [84.01398133305864, 28.108916240580612],
            [84.014045706075, 28.10945565348113],
          ],
        ]),
        {
          class: 6,
          "system:index": "13",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.01379894284563, 28.108433605686074],
            [84.01394914655046, 28.10800774956401],
            [84.01412080792741, 28.108490386374616],
            [84.01386331586198, 28.10869858197545],
          ],
        ]),
        {
          class: 6,
          "system:index": "14",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.01244710950212, 28.11019379305442],
            [84.01275824574785, 28.11047769153773],
            [84.01218961743669, 28.110307352537923],
          ],
        ]),
        {
          class: 6,
          "system:index": "15",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.01525667122735, 28.10533476275928],
            [84.01547124794854, 28.10521646614446],
            [84.0159862320794, 28.105140756242495],
            [84.01570728234185, 28.10536315392744],
          ],
        ]),
        {
          class: 6,
          "system:index": "16",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [83.95159089369055, 28.139770581661455],
            [83.95193958086249, 28.139666514080975],
            [83.95183765691992, 28.13983680643276],
          ],
        ]),
        {
          class: 6,
          "system:index": "17",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [83.94448137496414, 28.138152565225],
            [83.94448137496414, 28.137755209736167],
            [83.94464230750503, 28.137769401029004],
            [83.94467449401321, 28.137982270195945],
            [83.94495344375076, 28.138474232874618],
            [83.94476032470169, 28.138393816052766],
            [83.94462084983292, 28.13815729563861],
          ],
        ]),
        {
          class: 6,
          "system:index": "18",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [83.94346549196605, 28.13678546693941],
            [83.94366397543315, 28.136946302937265],
            [83.94372834844951, 28.137187556481326],
            [83.94345476312999, 28.136946302937265],
          ],
        ]),
        {
          class: 6,
          "system:index": "19",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [83.94066404356393, 28.13618942554796],
            [83.94068013681802, 28.136042779935444],
            [83.94105028166207, 28.13605697145512],
            [83.94095908655557, 28.13621307804729],
          ],
        ]),
        {
          class: 6,
          "system:index": "20",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.09787337549342, 28.22481537483308],
            [84.09789483316554, 28.224229277084817],
            [84.09802430367361, 28.22462160777235],
          ],
        ]),
        {
          class: 6,
          "system:index": "21",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.09600684009993, 28.22652679647415],
            [84.09598538242781, 28.226110863137006],
            [84.0963608916899, 28.22617703445813],
          ],
        ]),
        {
          class: 6,
          "system:index": "22",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.09696170650923, 28.22676312151182],
            [84.09722992741072, 28.226914369261316],
            [84.09677931629622, 28.22690491628325],
          ],
        ]),
        {
          class: 6,
          "system:index": "23",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.09042390432857, 28.22666344701567],
            [84.09075649824642, 28.226455480815954],
            [84.09100326147579, 28.226578369982967],
          ],
        ]),
        {
          class: 6,
          "system:index": "24",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.08804070261807, 28.228583622326383],
            [84.08846985606046, 28.228214961327218],
            [84.08867370394559, 28.228243319910828],
            [84.08825527933926, 28.22863088646494],
          ],
        ]),
        {
          class: 6,
          "system:index": "25",
        }
      ),
    ]),
  bare =
    /* color: #00ff00 */
    /* shown: false */
    ee.FeatureCollection([
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [83.92659911222377, 28.151120996993395],
            [83.92698535032191, 28.15021286367416],
            [83.92737158842006, 28.151120996993395],
          ],
        ]),
        {
          class: 7,
          "system:index": "0",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [83.93094705296197, 28.150631245920568],
            [83.93189119053521, 28.149987982672908],
            [83.93227742863336, 28.150971795487237],
          ],
        ]),
        {
          class: 7,
          "system:index": "1",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [83.91760038090386, 28.150076196172744],
            [83.9183084840838, 28.149622126045394],
            [83.91822265339532, 28.150416747504696],
          ],
        ]),
        {
          class: 7,
          "system:index": "2",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [83.9197676057879, 28.149716724147392],
            [83.91981052113213, 28.14914913428195],
            [83.92028258991876, 28.149811322165807],
          ],
        ]),
        {
          class: 7,
          "system:index": "3",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [83.95577095361256, 28.139252315279478],
            [83.9570208630135, 28.139228663451092],
            [83.95716033788227, 28.139611822427952],
            [83.95592115731739, 28.139484102921276],
          ],
        ]),
        {
          class: 7,
          "system:index": "4",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [83.95126902860876, 28.139515142874377],
            [83.95190202993628, 28.139207669452464],
            [83.95207369131323, 28.139515142874377],
          ],
        ]),
        {
          class: 7,
          "system:index": "5",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [83.94777850981924, 28.138907269303274],
            [83.94775705214713, 28.138618715710894],
            [83.94862072344992, 28.13885996548895],
            [83.9486529099581, 28.139134327321383],
            [83.94821302767966, 28.13894511233972],
          ],
        ]),
        {
          class: 7,
          "system:index": "6",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [83.92848122705664, 28.15455279487467],
            [83.92968285669531, 28.153190635668075],
            [83.93002617944921, 28.15500684409224],
          ],
        ]),
        {
          class: 7,
          "system:index": "7",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.09874269329512, 28.224097344750238],
            [84.09867832027876, 28.223634135616223],
            [84.09912893139327, 28.2236719486821],
            [84.09904310070479, 28.22405007860416],
          ],
        ]),
        {
          class: 7,
          "system:index": "8",
        }
      ),
      ee.Feature(
        ee.Geometry.Polygon([
          [
            [84.09702607952559, 28.22656460851533],
            [84.0972084697386, 28.22640390724778],
            [84.0971548255583, 28.22672530954095],
          ],
        ]),
        {
          class: 7,
          "system:index": "9",
        }
      ),
    ]);

//dataset filter
var imagery = ee
  .ImageCollection("COPERNICUS/S2_HARMONIZED")
  .filterDate("2023-10-01", "2023-12-30")
  // Pre-filter to get less cloudy granules.
  .filter(ee.Filter.lt("CLOUDY_PIXEL_PERCENTAGE", 20))
  .filterBounds(aoi)
  .map(maskS2clouds)
  .map(function (img) {
    return img.clip(aoi);
  })
  .median();
imagery = selectBands(imagery);
print(imagery);

// visualize imagery
Map.addLayer(imagery, rgb_viz, "dataset_rgbviz", false);

// variables
var palette = [
  "416422",
  "819A20",
  "2389da",
  "ff0000",
  "ffffff",
  "C2B280",
  "808080",
];
var classes = [1, 2, 3, 4, 5, 6, 7];
var classNames = [
  "Vegetation",
  "Cultivation",
  "Water",
  "Urban",
  "Cloud",
  "Sand",
  "bare",
];
var bands = [
  "B4",
  "B3",
  "B2",
  "B8",
  "B11",
  "B12",
  "NDVI",
  "NDBI",
  "MNDWI",
  "NDSLI",
];
var columns = [
  "B4",
  "B3",
  "B2",
  "B8",
  "B11",
  "B12",
  "NDVI",
  "NDBI",
  "MNDWI",
  "NDSLI",
  "class",
  "sample",
];

//===================================================
// Machine Learning Model
//===================================================
//merge samples
var samples = water
  .merge(cultivation)
  .merge(vegetation)
  .merge(builtup)
  .merge(cloud)
  .merge(sand)
  .merge(bare)
  .map(function (feat) {
    return feat.buffer(2);
  });

// Split samples to train and test per class
samples = ee
  .FeatureCollection(
    classes.map(function (value) {
      var features = samples
        .filter(ee.Filter.eq("class", value))
        .randomColumn();
      var train = features
        .filter(ee.Filter.lte("random", 0.85))
        .map(function (feat) {
          return feat.set("sample", "train");
        });
      var test = features
        .filter(ee.Filter.gt("random", 0.85))
        .map(function (feat) {
          return feat.set("sample", "test");
        });
      return train.merge(test);
    })
  )
  .flatten();

// Extract samples
var extractedSample = imagery.sampleRegions({
  collection: samples,
  scale: 10,
  properties: ["sample", "class"],
});

// Train samples
var trainSample = extractedSample.filter(ee.Filter.eq("sample", "train"));
print("Train sample size", trainSample.size());
var testSample = extractedSample.filter(ee.Filter.eq("sample", "test"));
print("Test sample size", testSample.size());

print(extractedSample.first());

Export.table.toDrive({
  collection: extractedSample,
  fileFormat: "CSV",
  selectors: columns,
  description: "lulc_samples",
  folder: "DL",
});

// Export image and samples
Export.image.toDrive({
  image: imagery.toFloat(),
  scale: 10,
  maxPixels: 1e13,
  region: aoi,
  crs: "EPSG:4326",
  folder: "DL",
  description: "s2_pokhara",
});

// Legend dict
var legend = {
  LULC_class_values: [1, 2, 3, 4, 5, 6, 7],
  LULC_class_palette: [
    "416422",
    "819A20",
    "2389da",
    "ff0000",
    "ffffff",
    "C2B280",
    "808080",
  ],
};

// Train rf model
var rf_model = ee.Classifier.smileRandomForest(300).train(
  trainSample,
  "class",
  bands
);

// Accuracy test
var cm = testSample
  .classify(rf_model, "predict")
  .errorMatrix("class", "predict");
print("Confusion matrix", cm, "Accuracy", cm.accuracy(), "Kappa", cm.kappa());

var lulc = imagery.classify(rf_model, "LULC").toByte().set(legend);
Map.addLayer(lulc, {}, "lulc", false);

//========================================================================
// function to select the required bands and add NDBI, NDVI, MNDWI indices
//========================================================================
function selectBands(image) {
  var ndvi = image
    .expression("(NIR - RED) / (NIR + RED)", {
      NIR: image.select("B8"),
      RED: image.select("B4"),
    })
    .rename("NDVI");

  var ndbi = image
    .expression("(SWIR - NIR) / (SWIR + NIR)", {
      NIR: image.select("B8"),
      SWIR: image.select("B11"),
    })
    .rename("NDBI");

  var mndwi = image
    .expression("(GREEN - SWIR1) / (GREEN + SWIR1)", {
      GREEN: image.select("B3"),
      SWIR1: image.select("B11"),
    })
    .rename("MNDWI");

  var ndsli = image
    .expression("(RED - SWIR1) / (RED + SWIR1)", {
      RED: image.select("B4"),
      SWIR1: image.select("B11"),
    })
    .rename("NDSLI");

  //required bands selection
  var bands = ["B4", "B3", "B2", "B8", "B11", "B12"];
  image = image.select(bands);

  // add NDVI, NDBI, NDSLI bands to image
  image = image.addBands(ee.Image([ndvi, mndwi, ndbi, ndsli]));
  return image;
}

//==================================================
// Legend
//=================================================
// set position of panel
var legend = ui.Panel({
  style: {
    position: "bottom-left",
    padding: "8px 15px",
  },
});

// Create legend title
var legendTitle = ui.Label({
  value: "LULC legend",
  style: {
    fontWeight: "bold",
    fontSize: "18px",
    margin: "0 0 4px 0",
    padding: "0",
  },
});

// Add the title to the panel
legend.add(legendTitle);

// Creates and styles 1 row of the legend.
var makeRow = function (color, name) {
  // Create the label that is actually the colored box.
  var colorBox = ui.Label({
    style: {
      backgroundColor: "#" + color,
      // Use padding to give the box height and width.
      padding: "8px",
      margin: "0 0 4px 0",
    },
  });

  // Create the label filled with the description text.
  var description = ui.Label({
    value: name,
    style: { margin: "0 0 4px 6px" },
  });

  // return the panel
  return ui.Panel({
    widgets: [colorBox, description],
    layout: ui.Panel.Layout.Flow("horizontal"),
  });
};

//  Palette with the colors
var palette = [
  "416422",
  "819A20",
  "2389da",
  "ff0000",
  "ffffff",
  "C2B280",
  "808080",
];

// name of the legend
var names = [
  "Vegetation",
  "Cultivation",
  "Water",
  "Urban",
  "Cloud",
  "Sand",
  "bare",
];

// Add color and and names
for (var i = 0; i < names.length; i++) {
  legend.add(makeRow(palette[i], names[i]));
}

// add legend to map (alternatively you can also print the legend to the console)
Map.add(legend);

//==================================================
//S2 imagery cloud mask
//==================================================
function maskS2clouds(image) {
  var qa = image.select("QA60");

  // Bits 10 and 11 are clouds and cirrus, respectively.
  var cloudBitMask = 1 << 10;
  var cirrusBitMask = 1 << 11;

  // Both flags should be set to zero, indicating clear conditions.
  var mask = qa
    .bitwiseAnd(cloudBitMask)
    .eq(0)
    .and(qa.bitwiseAnd(cirrusBitMask).eq(0));

  return image.updateMask(mask).divide(10000);
}
